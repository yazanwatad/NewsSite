<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Select Interests</title>
  <link rel="stylesheet" href="../CSS/Styles.css">
</head>
<body>
  <div class="general-container">
    <h2>Tell us what you like</h2>
    <textarea id="userInput" placeholder="e.g. I like football, snooker, and politics."></textarea><br>
    <button onclick="getTags()">Save Interests</button>

    <h3>Detected Tags:</h3>
    <pre id="result">{}</pre>
  </div>

  <script>
    async function getTags() {
      const prompt = document.getElementById('userInput').value;
      const resultBox = document.getElementById('result');

      resultBox.textContent = 'Loading...';

      const systemMessage = `
You are a smart tag extractor. From the user's sentence, extract 3â€“6 simple interest tags.
Return a JSON object like:
{ "tags": ["football", "snooker", "politics"] }
Only return valid JSON. No explanation.
      `;

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer YOUR_API_KEY_HERE"
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [
              { role: "system", content: systemMessage },
              { role: "user", content: prompt }
            ],
            temperature: 0.4
          })
        });

        const data = await response.json();
        const content = data.choices[0].message.content;
        resultBox.textContent = content;

        const parsed = JSON.parse(content);
        const tags = parsed.tags;

        const jwt = localStorage.getItem('jwtToken');
        const saveResponse = await fetch("/api/UserTags", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + jwt
          },
          body: JSON.stringify(tags)
        });

        if (saveResponse.ok) {
          alert("Tags saved successfully! Redirecting to home page...");
          setTimeout(() => window.location.href = "index.html", 1500);
        } else {
          alert("Failed to save tags.");
        }

      } catch (error) {
        resultBox.textContent = "Error: " + error.message;
      }
    }
  </script>
</body>
</html>
